const t=new class{constructor(t){this.size=4,this.board=t||this.createEmptyBoard(),this.score=0,this.history=[],this.scoreHistory=[],this.undoCount=2,this.shuffleCount=1,this.removeCount=0,this.has256=!1,this.has512=!1,this.status="idle"}moveLeft(){if("playing"!==this.status)return;this.savePreviousState();let t=!1;for(let e=0;e<this.size;e++){let s=this.board[e].filter(t=>0!==t);for(let t=0;t<s.length-1;t++)s[t]===s[t+1]&&(s[t]*=2,this.score+=s[t],s[t+1]=0,this.checkWin(s[t]),this.checkUnlocks(s[t]));let i=s.filter(t=>0!==t);for(;i.length<this.size;)i.push(0);this.board[e].toString()!==i.toString()&&(t=!0),this.board[e]=i}t&&(this.addRandomTile(),this.isGameOver()&&(this.status="lose"))}moveRight(){this.board=this.reverseRows(this.board),this.moveLeft(),"win"!==this.status&&(this.board=this.reverseRows(this.board))}moveUp(){this.board=this.transpose(this.board),this.moveLeft(),"win"!==this.status&&(this.board=this.transpose(this.board))}moveDown(){this.board=this.transpose(this.board),this.board=this.reverseRows(this.board),this.moveLeft(),"win"!==this.status&&(this.board=this.reverseRows(this.board),this.board=this.transpose(this.board))}start(){"playing"!==this.status&&(this.board=this.createEmptyBoard(),this.addRandomTile(),this.addRandomTile(),this.score=0,this.status="playing",this.undoCount=2,this.shuffleCount=1,this.removeCount=0,this.has256=!1,this.has512=!1)}restart(){this.status="idle",this.start()}savePreviousState(){this.history.push(this.board.map(t=>[...t])),this.scoreHistory.push(this.score),this.history.length>2&&(this.history.shift(),this.scoreHistory.shift())}undo(){this.undoCount>0&&this.history.length>0&&(this.board=this.history.pop(),this.score=this.scoreHistory.pop(),this.undoCount--)}shuffle(){if(0===this.shuffleCount)return;let t=this.board.flat().filter(t=>0!==t);for(let e=t.length-1;e>0;e--){let s=Math.floor(Math.random()*(e+1));[t[e],t[s]]=[t[s],t[e]]}let e=this.createEmptyBoard();t.forEach((t,s)=>{let i=Math.floor(s/this.size),o=s%this.size;e[i][o]=t}),this.board=e,this.shuffleCount--}remove(){if(0===this.removeCount)return;let t=[];for(let e=0;e<this.size;e++)for(let s=0;s<this.size;s++)0!==this.board[e][s]&&t.push([e,s]);if(0===t.length)return;let[e,s]=t[Math.floor(Math.random()*t.length)];this.board[e][s]=0,this.removeCount--}checkWin(t){2048===t&&(this.status="win")}checkUnlocks(t){256!==t||this.has256||(this.shuffleCount++,this.has256=!0),512===t&&this.removeCount<2&&(this.removeCount++,this.has512=!0)}createEmptyBoard(){return Array.from({length:this.size},()=>Array(this.size).fill(0))}addRandomTile(){let t=[];for(let e=0;e<this.size;e++)for(let s=0;s<this.size;s++)0===this.board[e][s]&&t.push([e,s]);if(t.length>0){let[e,s]=t[Math.floor(Math.random()*t.length)];this.board[e][s]=.9>Math.random()?2:4}}isGameOver(){for(let t=0;t<this.size;t++)for(let e=0;e<this.size;e++)if(0===this.board[t][e]||e<this.size-1&&this.board[t][e]===this.board[t][e+1]||t<this.size-1&&this.board[t][e]===this.board[t+1][e])return!1;return!0}reverseRows(t){return t.map(t=>[...t].reverse())}transpose(t){return t[0].map((e,s)=>t.map(t=>t[s]))}getState(){return this.board}getScore(){return this.score}getStatus(){return this.status}},e=document.querySelector(".game-field"),s=document.querySelector(".game-score"),i=document.querySelector(".message-lose"),o=document.querySelector(".button.start"),r=document.querySelector(".message-start"),h=document.querySelector(".game-tools"),a=document.querySelector(".undo-button"),n=document.querySelector(".shuffle-button"),l=document.querySelector(".remove-button");function d(){let o=t.getState(),r=t.getStatus();switch(e.querySelectorAll(".field-cell").forEach((t,e)=>{let s=o[Math.floor(e/4)][e%4];t.textContent=0===s?"":s,t.className="field-cell",s>0&&t.classList.add(`field-cell--${s}`)}),s.textContent=t.getScore(),r){case"win":i.textContent="You win!",i.classList.remove("hidden");break;case"lose":i.textContent="You lose! Restart the game?",i.classList.remove("hidden");break;default:i.classList.add("hidden")}!function(){let e=(t,e,s)=>{Array.from(t.querySelectorAll(".use-slot")).forEach((t,s)=>{t.classList.toggle("used",s<e)}),t.disabled=0===e};e(a,t.undoCount,2),e(n,t.shuffleCount,2),e(l,t.removeCount,2)}()}document.addEventListener("keydown",e=>{if("playing"!==t.getStatus())return;let s={ArrowLeft:()=>t.moveLeft(),ArrowRight:()=>t.moveRight(),ArrowUp:()=>t.moveUp(),ArrowDown:()=>t.moveDown()}[e.key];s&&(s(),d())}),o.addEventListener("click",()=>{"idle"===t.getStatus()?(t.start(),r.classList.add("hidden"),o.classList.remove("start"),o.classList.add("restart"),o.textContent="Restart",h.classList.remove("hidden")):t.restart(),d()}),a.addEventListener("click",()=>{t.undo(),d()}),n.addEventListener("click",()=>{t.shuffle(),d()}),l.addEventListener("click",()=>{t.remove(),d()}),d();
//# sourceMappingURL=index.f752c48c.js.map
