!function(){function t(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,o=Array(e);r<e;r++)o[r]=t[r];return o}function e(e,r){if(e){if("string"==typeof e)return t(e,r);var o=Object.prototype.toString.call(e).slice(8,-1);if("Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o)return Array.from(o);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return t(e,r)}}function r(t,r){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r,o,n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var s=[],i=!0,a=!1;try{for(n=n.call(t);!(i=(r=n.next()).done)&&(s.push(r.value),!e||s.length!==e);i=!0);}catch(t){a=!0,o=t}finally{try{i||null==n.return||n.return()}finally{if(a)throw o}}return s}}(t,r)||e(t,r)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(r){return function(e){if(Array.isArray(e))return t(e)}(r)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(r)||e(r)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var n=new/*#__PURE__*/(function(){var t;function e(t){!function(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}(this,e),this.size=4,this.board=t||this.createEmptyBoard(),this.score=0,this.history=[],this.scoreHistory=[],this.undoCount=2,this.shuffleCount=1,this.removeCount=0,this.has256=!1,this.has512=!1,this.status="idle"}return t=[{key:"moveLeft",value:function(){var t=this;if("playing"===this.status){this.savePreviousState();for(var e=!1,r=0;r<this.size;r++)!function(r){for(var o=t.board[r].filter(function(t){return 0!==t}),n=0;n<o.length-1;n++)o[n]===o[n+1]&&(o[n]*=2,t.score+=o[n],o[n+1]=0,t.checkWin(o[n]),t.checkUnlocks(o[n]));for(var s=o.filter(function(t){return 0!==t});s.length<t.size;)s.push(0);t.board[r].toString()!==s.toString()&&(e=!0),t.board[r]=s}(r);e&&(this.addRandomTile(),this.isGameOver()&&(this.status="lose"))}}},{key:"moveRight",value:function(){this.board=this.reverseRows(this.board),this.moveLeft(),"win"!==this.status&&(this.board=this.reverseRows(this.board))}},{key:"moveUp",value:function(){this.board=this.transpose(this.board),this.moveLeft(),"win"!==this.status&&(this.board=this.transpose(this.board))}},{key:"moveDown",value:function(){this.board=this.transpose(this.board),this.board=this.reverseRows(this.board),this.moveLeft(),"win"!==this.status&&(this.board=this.reverseRows(this.board),this.board=this.transpose(this.board))}},{key:"start",value:function(){"playing"!==this.status&&(this.board=this.createEmptyBoard(),this.addRandomTile(),this.addRandomTile(),this.score=0,this.status="playing",this.undoCount=2,this.shuffleCount=1,this.removeCount=0,this.has256=!1,this.has512=!1)}},{key:"restart",value:function(){this.status="idle",this.start()}},{key:"savePreviousState",value:function(){this.history.push(this.board.map(function(t){return o(t)})),this.scoreHistory.push(this.score),this.history.length>2&&(this.history.shift(),this.scoreHistory.shift())}},{key:"undo",value:function(){this.undoCount>0&&this.history.length>0&&(this.board=this.history.pop(),this.score=this.scoreHistory.pop(),this.undoCount--)}},{key:"shuffle",value:function(){var t=this;if(0!==this.shuffleCount){for(var e=this.board.flat().filter(function(t){return 0!==t}),r=e.length-1;r>0;r--){var o,n=Math.floor(Math.random()*(r+1));o=[e[n],e[r]],e[r]=o[0],e[n]=o[1]}var s=this.createEmptyBoard();e.forEach(function(e,r){var o=Math.floor(r/t.size),n=r%t.size;s[o][n]=e}),this.board=s,this.shuffleCount--}}},{key:"remove",value:function(){if(0!==this.removeCount){for(var t=[],e=0;e<this.size;e++)for(var o=0;o<this.size;o++)0!==this.board[e][o]&&t.push([e,o]);if(0!==t.length){var n=r(t[Math.floor(Math.random()*t.length)],2),s=n[0],i=n[1];this.board[s][i]=0,this.removeCount--}}}},{key:"checkWin",value:function(t){2048===t&&(this.status="win")}},{key:"checkUnlocks",value:function(t){256!==t||this.has256||(this.shuffleCount++,this.has256=!0),512===t&&this.removeCount<2&&(this.removeCount++,this.has512=!0)}},{key:"createEmptyBoard",value:function(){var t=this;return Array.from({length:this.size},function(){return Array(t.size).fill(0)})}},{key:"addRandomTile",value:function(){for(var t=[],e=0;e<this.size;e++)for(var o=0;o<this.size;o++)0===this.board[e][o]&&t.push([e,o]);if(t.length>0){var n=r(t[Math.floor(Math.random()*t.length)],2),s=n[0],i=n[1];this.board[s][i]=.9>Math.random()?2:4}}},{key:"isGameOver",value:function(){for(var t=0;t<this.size;t++)for(var e=0;e<this.size;e++)if(0===this.board[t][e]||e<this.size-1&&this.board[t][e]===this.board[t][e+1]||t<this.size-1&&this.board[t][e]===this.board[t+1][e])return!1;return!0}},{key:"reverseRows",value:function(t){return t.map(function(t){return o(t).reverse()})}},{key:"transpose",value:function(t){return t[0].map(function(e,r){return t.map(function(t){return t[r]})})}},{key:"getState",value:function(){return this.board}},{key:"getScore",value:function(){return this.score}},{key:"getStatus",value:function(){return this.status}}],function(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}(e.prototype,t),e}()),s=document.querySelector(".game-field"),i=document.querySelector(".game-score"),a=document.querySelector(".message-lose"),u=document.querySelector(".button.start"),h=document.querySelector(".message-start"),l=document.querySelector(".game-tools"),c=document.querySelector(".undo-button"),f=document.querySelector(".shuffle-button"),d=document.querySelector(".remove-button");function v(){var t,e=n.getState(),r=n.getStatus();switch(s.querySelectorAll(".field-cell").forEach(function(t,r){var o=e[Math.floor(r/4)][r%4];t.textContent=0===o?"":o,t.className="field-cell",o>0&&t.classList.add("field-cell--".concat(o))}),i.textContent=n.getScore(),r){case"win":a.textContent="You win!",a.classList.remove("hidden");break;case"lose":a.textContent="You lose! Restart the game?",a.classList.remove("hidden");break;default:a.classList.add("hidden")}(t=function(t,e,r){Array.from(t.querySelectorAll(".use-slot")).forEach(function(t,r){t.classList.toggle("used",r<e)}),t.disabled=0===e})(c,n.undoCount,2),t(f,n.shuffleCount,2),t(d,n.removeCount,2)}document.addEventListener("keydown",function(t){if("playing"===n.getStatus()){var e={ArrowLeft:function(){return n.moveLeft()},ArrowRight:function(){return n.moveRight()},ArrowUp:function(){return n.moveUp()},ArrowDown:function(){return n.moveDown()}}[t.key];e&&(e(),v())}}),u.addEventListener("click",function(){"idle"===n.getStatus()?(n.start(),h.classList.add("hidden"),u.classList.remove("start"),u.classList.add("restart"),u.textContent="Restart",l.classList.remove("hidden")):n.restart(),v()}),c.addEventListener("click",function(){n.undo(),v()}),f.addEventListener("click",function(){n.shuffle(),v()}),d.addEventListener("click",function(){n.remove(),v()}),v()}();
//# sourceMappingURL=index.3805a78b.js.map
